'use strict';(function(){var a=function(a){function b(a,b){var c,d,e,g='TemplateError';a.textContent.replace(/ line (\d+?)| column (\d+?)|: (.*?)$/gm,function(a,b,f,g){c=c||b,d=d||f,e=e||g}),f(this,{message:e,name:g,file:b,line:c,column:d,stack:g+' '+e+'\n\tat '+(this.file||'<anonymous>')+':'+c+':'+d})}var c=function(){},d=function(){return{output:[],update:c}},e=Object.keys,f=Object.assign,g='parsererror',h='_yieldedTemplate_',i=Array.isArray,j=[].forEach,k=a.parseFromString('<html><head></head><body></body></html>'),l=k.createElement('div'),m={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9},n={},o=function(a){return n[a]},p=function(a,b){b.parentNode.insertBefore(a,b)},q=function(a){a.parentNode.removeChild(a)},r=function(a){return l.textContent=a,l.innerHTML},t=function(a){var b=a.ownerDocument.createDocumentFragment();return b.appendChild(a),a},s=function(a){return t(a.createTextNode(''))},u=function(a,b,c){a=a||d,b=b||d;var e=y(c);return function(c,f,g){var h,i=d(),j=s(c),k=function(f){if(!j.parentNode)return i=d(),void(h=void 0);var k=!!e(f);k===h?i.update(f):(h=k,i.output.forEach(function(a){return q(a)}),i=k?a(c,f,g):b(c,f,g),i.output.forEach(function(a){return p(a,j)}))};return k(f),{output:[].slice.call(j.parentNode.childNodes),update:k}}},v=function(a,b,c){var e=y(b),g=c?y(c):function(a){return a},i=function(b){var c=f({},b);return c[h]=a,c};return function(a,b,c){var f,h=s(a),j={output:[],update:function(){}},k=function(b){b=i(g(b));var k=e(b)||d;k===f?j.update(b):(f=k,'string'==typeof f&&(f=o(f)),j.output.forEach(function(a){return q(a)}),j=f(a,b,c),j.output.forEach(function(a){return p(a,h)}))};return k(b),{output:[].slice.call(j.output).concat([h]),update:k}}},w=function(a,b,c,d){var e=y(b),f=[],g=[];c=c||'content',d=d||'index';var h=function(a,b,e){var f={parent:a};return f[c]=e,f[d]=b,f};return function(b,c,d){var j=s(b),i=function(c){if(!j.parentNode)return f=[],void(g=[]);var k=e(c)||[];for(var l=Math.max(f.length,k.length),m=j.parentNode,n=function(e){var i=g[e+1]&&g[e+1].output[0]||j;f[e]&&k[e]?f[e]!==k[e]&&g[e].update(h(c,e,k[e])):f[e]&&!k[e]?(g[e].output.forEach(function(a){return q(a)}),g[e]=null):!f[e]&&k[e]&&(g[e]=a(b,h(c,e,k[e]),d),g[e].output.forEach(function(a){return p(a,i)}))},o=0;o<l;o+=1)n(o);g.length=k.length,f=k};return i(c),{output:[].slice.call(j.parentNode.childNodes),update:i}}},x=function(a){var b,c=[],d=[],e=0;b=0;for(var f=0;f<a.length;f+=1){if('\\'===a[f]&&'$'===a[f+1]||'\\'===a[f+1]){d.push(a[f+1]),f+=1;continue}if(0===b&&'$'===a[f]&&'{'===a[f+1]){b=1,f+=1,e=1,c.push(d.join('')),d=[];continue}if(1===b){if('{'===a[f]){e+=1,d.push(a[f]);continue}if('}'===a[f]&&(e-=1,0==e)){b=0,c.push(d.join('')),d=[];continue}}d.push(a[f])}if(1===b)throw new Error('Unclosed template literal: '+a);return d.length&&c.push(d.join('')),c},y=function(a){var b='return function(state){try{with(state){return($)}}catch(e){return undefined}}'.replace(/\$/g,a),c=new Function('sanitize',b)(r);return c.expression=a,c},z=function(a){return a=a.map(function(a){return'string'==typeof a?H(a):i(a)?z(a):a}),function(b,c,d){var e=[],f=[];return a.forEach(function(a){var g=a(b,c,d);e=e.concat(g.output),f.push(g.update)}),{output:e,update:function update(a){f.forEach(function(b){return b(a)})}}}},A=function(a){var b=[];return a.forEach(function(a){if(a.nodeType===m.TEXT_NODE)return x(a.textContent).forEach(function(a,d){if(a)if(0==d%2)b.push(function(b){return{output:[b.createTextNode(a)],update:c}});else{var e=y(a);b.push(function(a,b){var c=a.createTextNode(e(b));return{output:[c],update:function update(a){c.textContent=e(a)}}})}});if(a.nodeType===m.ELEMENT_NODE){var e=a.tagName,d=e.toLowerCase();if(o.tagHandlers[d])return void b.push(C(d,a));var f=A([].slice.call(a.childNodes)),g=[],h=[];j.call(a.attributes,function(a){'on-'===a.nodeName.substr(0,3)?h.push({name:a.nodeName.substr(3),action:new Function('event','state','dispatch','with(state){\n'+a.nodeValue+'\n}')}):g.push({name:a.nodeName,value:x(a.nodeValue).map(function(a,b){return 0==b%2?a:y(a)})})}),b.push(function(a,b,c){var d=a.createElement(e);h.forEach(function(a){d.addEventListener(a.name,function(b){return a.action.call(b.target,b,j,c)},!1)});var i=[];f.forEach(function(e){var f=e(a,b,c);i.push(f.update),f.output.forEach(function(a){d.appendChild(a)})});var j=b,k=function(a){j=a,g.forEach(function(b){E[b.name]?E[b.name](a,d,b.value):d.setAttribute(b.name,b.value.map(function(b){return b instanceof Function?b(a):b}).join(''))}),i.forEach(function(b){return b(a)})};return k(b),{output:[d],update:k}})}}),b},B=function(a){return z(A([].slice.call(a)))},C=function(a,b){var c={};return j.call(b.attributes,function(a){c[a.nodeName]=a.nodeValue}),c.TEMPLATE=B(b.childNodes),o.tagHandlers[a](c)},D=function(a,b){return a.map(function(a,c){if(0==c%2)return a;var d=a(b);return!0===d?a.expression.replace(/^[^\.]*\./,''):d?d:''}).join('').trim()},E={class:function _class(a,b,c){b.className=D(c,a)}},F=function(a,b,c){var d=c;'string'==typeof d&&(d=H(c)),i(d)&&(d=z(d)),o.tagHandlers[a]=function(a){var c=b.reduce(function(b,c){return b[c]=y(a[c]),b},{}),g=function(a){var b=f({},a);return e(c).forEach(function(d){b[d]=c[d](a)}),b};return function(a,b,c){var e=d(a,g(b),c);return e.update=G(e.update,g),e}}},G=function(a,b){return function(c){a(b(c))}},H=function(c,d){var e=a.parseFromString('<G>'+c+'</G>','text/xml'),f=e.getElementsByTagName(g)[0];if(f)throw new b(e.querySelector(g+'>div'),d);var h=A([].slice.call(e.childNodes[0].childNodes));return z(h)};return f(o,{compile:H,fetch:function fetchTemplate(a,b){var c,e=null,g=function(){return e=fetch(a).then(function(a){return a.text()}).then(function(b){return H(b,a)}),e};return template=function template(a,d,h){if(c)return c(a,d,h);e||g();var i=t(f(a.createElement('div'),{className:b||'glace-loading'})),j=[i],k=d,l=function update(a){k=a};return e.then(function(b){var c=b(a,k,h);l=c.update,c.output.forEach(function(a){p(a,i),j.push(a)}),j.shift(),q(i)}),{output:j,update:function update(a){return l(a)}}},template.fetch=g,template},append:function append(a,b,c,d){'string'==typeof b&&(b=o(b));var e=a.ownerDocument,f=null;c&&c.getState&&c.subscribe&&(f=c,d=f.dispatch,c=f.getState());var g=b(e,c,d);if(g.output.forEach(function(b){a.appendChild(b)}),f){var h=!1;f.subscribe(function(){h||(h=!0,requestAnimationFrame(function(){g.update(f.getState()),h=!1}))})}return g.update},tagHandlers:{if:function _if(a){return u(a.TEMPLATE,null,a.cond)},unless:function unless(a){return u(null,a.TEMPLATE,a.cond)},for:function _for(a){return w(a.template||a.TEMPLATE,a.each,a.as,a.index)},view:function view(a){return v(a.TEMPLATE,a.template,a.state)},yield:function _yield(){return function(a,b,c){var d=f({},b);return delete d[h],b[h](a,d,c)}}},tagHandler:F,getter:y,registerTemplate:function registerTemplate(a,b,c){var d;d=n[a]?n[a]:c(),b&&(b=b.split(',').map(function(a){return a.trim()}),F(a,b,d)),n[a]=d},Error:b}),o};(function(){try{try{define('Glace',function(){return a})}catch(b){module.exports=a}}catch(c){var b=window.Glace=a(new DOMParser);each.call(document.querySelectorAll('script[id][type="'+CONTENT_TYPE+'"]'),function(){b.registerTemplate(scr.id,scr.getAttribute('props'),function(){return b.compile(scr.textContent,'#'+scr.id)})}),each.call(document.querySelectorAll('meta[glace-template]'),function(a){var c=a.getAttribute('glace-template'),d=c.replace(/^.*\/|\.tpl$/g,'');b.registerTemplate(d,a.getAttribute('props'),function(){return b.fetchTemplate(c,a.getAttribute('loading-class'))})})}})()})();
